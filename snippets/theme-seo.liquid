{% assign url = shop.url %}

{%- if template.name == 'index' or template == 'index' -%}
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": {{ shop.name | json }},
      "url": "https://{{ shop.domain }}",
      "description": {{ shop.description | json }},
      {%- unless logo_url == blank -%}
        "image": "{{ logo_url | remove: "\" }}",
        "logo": "{{ logo_url | remove: "\" }}",
      {%- else - -%}
        "image": "https:{{ 'logo.svg' | file_url }}",
        "logo": "https:{{ 'logo.svg' | file_url }}",
      {%- endunless -%}
      "sameAs": ["{{ booster_config.same_as | join: '", "'}}"],
      "telephone": "{{ shop.phone }}",
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "{{ shop.address.street }}",
        "addressLocality": "{{ shop.address.city }}",
        "addressRegion": "{{ shop.address.province }}",
        "postalCode": "{{ shop.address.zip }}",
        "addressCountry": "{{ shop.address.country }}"
      }
    }
  </script>
{%- endif -%}

{% if template contains 'product' %}
  {%- assign review_count = product.metafields.judgeme.badge
    | split: "data-number-of-reviews='"
    | last
    | split: "'"
    | first
    | plus: 0
  -%}

  {%- assign review_value = product.metafields.judgeme.badge
    | split: "data-average-rating='"
    | last
    | split: "'"
    | first
    | plus: 0
  -%}

  <script type="application/ld+json">
    {
      "@context": "http://schema.org/",
      "@type": "Product",
      "@id": {{ canonical_url | append: '#product' | json }},
      "name": "{{ product.title | strip_html | escape | replace: '"', '' }}",
      "url": "{{ shop.url }}{{ product.url }}",

      {% if product.first_available_variant.sku != blank %}
        "sku": "{{ product.first_available_variant.sku }}",
      {% else %}
        "sku": "{{ product.first_available_variant.id }}",
      {% endif %}

      {% if product.first_available_variant.barcode.size == 8 %}
        "gtin8": {{ product.first_available_variant.barcode }},
      {% endif %}

      {% if product.first_available_variant.barcode.size == 12 %}
        "gtin12": {{ product.first_available_variant.barcode }},
      {% endif %}

      {% if product.first_available_variant.barcode.size == 13 %}
        "gtin13": {{ product.first_available_variant.barcode }},
      {% endif %}

      {% if product.first_available_variant.barcode.size == 14 %}
        "gtin14": {{ product.first_available_variant.barcode }},
      {% endif %}

      "brand": {
        "@type": "Brand",
        "name": "{{ product.vendor | escape  | default : 'redragon' }}"
      },
      "description": "{{ product.description | strip_html | strip_newlines | strip | remove: '"' | replace: '&gt;', '' | default: product.title | strip_html | escape | replace: '"', '' }} {{ product.metafields.custom_desc.short_desc | replace: '&gt;', '' | strip_html | escape | replace: '"', '' }}",
      "image": "https:{{ product.featured_image.src | image_url: width: 100 }}",
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": {{ review_value }},
        "bestRating": 5,
        "worstRating": 0,
        "reviewCount": {% if review_count <= 0 %}1{% else %}{{ review_count }}{% endif %}
      },
      "review": {
        "@type": "Review",
        "reviewRating": {
          "@type": "Rating",
          "ratingValue": 4,
          "bestRating": 5
        },
        "author": {
          "@type": "Person",
          "name": "Fred Benson"
        }
      },
      "offers": {
        "@type": "AggregateOffer",
        "priceCurrency": "{{ shop.currency }}",
        "lowPrice": "{{ product.price_min  | money_without_currency   | strip_html }}",
        "highPrice": "{{ product.price_max   | money_without_currency  | strip_html  }}",
        "priceValidUntil":"2030/12/12",
        "shippingDetails": {
          "@type": "OfferShippingDetails",
          "shippingRate": {
            "@type": "MonetaryAmount",
            "value": 0,
            "currency": "USD"
          },
          "shippingDestination": {
            "@type": "DefinedRegion",
            "addressCountry": "CA"
          },
          "deliveryTime": {
            "@type": "ShippingDeliveryTime",
            "handlingTime": {
              "@type": "QuantitativeValue",
              "minValue": 3,
              "maxValue": 7,
              "unitCode": "DAY"
            },
            "transitTime": {
              "@type": "QuantitativeValue",
              "minValue": 3,
              "maxValue": 7,
              "unitCode": "DAY"
            }
          }
        },
        "hasMerchantReturnPolicy": {
          "@type": "MerchantReturnPolicy",
          "applicableCountry": "CA",
          "returnPolicyCategory": "https://schema.org/MerchantReturnFiniteReturnWindow",
          "merchantReturnDays": 30,
          "returnMethod": "https://schema.org/ReturnByMail",
          "returnFees": "https://schema.org/FreeReturn"
        },
        "name": "Fred Benson",
        "offerCount": "{% assign count = 0 %}{% if product.available %}{% for variant in product.variants %}{% assign count =  count | plus : variant.inventory_quantity %}{% endfor %}{% endif %}{% if count <= 0 %}1{% else %}{{ count }}{% endif %}",


        {% if product.variants %}
          "offers": [
            {% for variant in product.variants %}
              {
                "@type" : "Offer",
                "priceCurrency": "{{ shop.currency }}",
                "price": "{{ variant.price | money_without_currency  | strip_html }}",
                "itemCondition" : "http://schema.org/NewCondition",
                "availability" : "http://schema.org/{% if variant.available %}InStock{% else %}OutOfStock{% endif %}",
                "url" : "{{ shop.url }}{{ variant.url }}",
                "priceValidUntil":"2030/12/12",
                "hasMerchantReturnPolicy": {
                  "@type": "MerchantReturnPolicy",
                  "applicableCountry": "US",
                  "returnPolicyCategory": "https://schema.org/MerchantReturnFiniteReturnWindow",
                  "merchantReturnDays": 30,
                  "returnMethod": "https://schema.org/ReturnByMail",
                  "returnFees": "https://schema.org/FreeReturn"
                },
                "shippingDetails": {
                  "@type": "OfferShippingDetails",
                  "shippingRate": {
                    "@type": "MonetaryAmount",
                    "value": 0,
                    "currency": "USD"
                  },
                  "shippingDestination": {
                    "@type": "DefinedRegion",
                    "addressCountry": "CA"
                  },
                  "deliveryTime": {
                    "@type": "ShippingDeliveryTime",
                    "handlingTime": {
                      "@type": "QuantitativeValue",
                      "minValue": 3,
                      "maxValue": 7,
                      "unitCode": "DAY"
                    },
                    "transitTime": {
                      "@type": "QuantitativeValue",
                      "minValue": 3,
                      "maxValue": 7,
                      "unitCode": "DAY"
                    }
                  }
                },
                "itemOffered" :
                {
                    "@type" : "Product",
                    {% if variant.image %}
                      {% assign variant_image_size = variant.image.width | append: 'x' %}
                      "image": "http:{{ variant.image.src | image_url: variant_image_size }}",
                    {% else %}
                      "image": "http:{{ product.featured_image.src | image_url: width: 100 }}",
                    {% endif %}
                    {% if variant.title != blank %}
                      "name" : "{{ variant.title | escape | replace: '"', ''}}",
                    {% endif %}
                    {% if variant.barcode.size == 12 %}
                      "gtin12": "{{ variant.barcode }}",
                    {% endif %}
                    {% if variant.barcode.size == 13 %}
                      "gtin13": "{{ variant.barcode }}",
                    {% endif %}
                    {% if variant.barcode.size == 14 %}
                      "gtin14": "{{ variant.barcode }}",
                    {% endif %}
                      "brand": "{{ product.vendor }}",
                    {% if variant.description != blank %}
                      "description" : "{{ variant.description | strip_html  | remove: '"' | remove :'&amp;' | default: product.title | strip_html | escape | replace: '"', '' }}",
                    {% else %}
                      "description" : "{{ product.description | strip_html  | remove : '"' | remove :'&amp;' | default: product.title | strip_html | escape | replace: '"', '' }}",
                    {% endif %}
                    {% if variant.sku != blank %}
                      "sku": "{{ variant.sku }}",
                      {% else %}
                      "sku": "{{ variant.id }}",
                    {% endif %}
                    {% if variant.weight != blank %}
                      "weight": {
                        "@type": "QuantitativeValue",
                        {% if variant.weight_unit != blank %}
                          "unitCode": "{{ variant.weight_unit }}",
                        {% endif %}
                        "value": "{{ variant.weight | weight_with_unit: variant.weight_unit }}"
                      },
                    {% endif %}
                    "offers":[{
                      "@type" : "Offer",
                      "priceCurrency": "{{ shop.currency }}",
                      "price": "{{ variant.price | money_without_currency  | strip_html }}",
                      "itemCondition" : "http://schema.org/NewCondition",
                      "availability" : "http://schema.org/{% if variant.available %}InStock{% else %}OutOfStock{% endif %}",
                      "url" : "{{ shop.url }}{{ variant.url }}",
                      "priceValidUntil":"2030/12/12",
                      "hasMerchantReturnPolicy": {
                        "@type": "MerchantReturnPolicy",
                        "applicableCountry": "CA",
                        "returnPolicyCategory": "https://schema.org/MerchantReturnFiniteReturnWindow",
                        "merchantReturnDays": 30,
                        "returnMethod": "https://schema.org/ReturnByMail",
                        "returnFees": "https://schema.org/FreeReturn"
                      },
                      "shippingDetails": {
                        "@type": "OfferShippingDetails",
                        "shippingRate": {
                          "@type": "MonetaryAmount",
                          "value": 0,
                          "currency": "CAD"
                        },
                        "shippingDestination": {
                          "@type": "DefinedRegion",
                          "addressCountry": "CA"
                        },
                        "deliveryTime": {
                          "@type": "ShippingDeliveryTime",
                          "handlingTime": {
                            "@type": "QuantitativeValue",
                            "minValue": 3,
                            "maxValue": 7,
                            "unitCode": "DAY"
                          },
                          "transitTime": {
                            "@type": "QuantitativeValue",
                            "minValue": 3,
                            "maxValue": 7,
                            "unitCode": "DAY"
                          }
                        }
                      }
                      }
                    ],
                    "url": "{{ shop.url }}{{ variant.url }}"
                    {% if review_count > 0   %}
                    ,"aggregateRating": {
                      "@type": "AggregateRating",
                      "ratingValue": {{ review_value }},
                      "bestRating": 5,
                      "worstRating": 0,
                      "reviewCount": {% if review_count <= 0 %}1{% else %}{{ review_count }}{% endif %},
                      "itemReviewed":"Product"
                    }
                    {% endif %}


                }
              }{% unless forloop.last %},{% endunless %}
            {% endfor %}
          ]
        {% endif %}
      }
    }
  </script>

  <script type="application/ld+json">
    {
    "@context": "http://schema.org/",
    "@type": "BreadcrumbList",
    "itemListElement": [{
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{url}}"
    },
    {% if collection %}
    {
      "@type": "ListItem",
      "position": 2,
      "name": "{{ collection.title  | replace: '"', '' }}",
      "item": "{{url}}/{{ collection.handle }}"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "{{ product.title | replace: '"', '' }}",
      "item": "{{ canonical_url }}"
    }
    {% else %}
    {
      "@type": "ListItem",
      "position": 2,
      "name": "{{ product.title | replace: '"', '' }}",
      "item": "{{ canonical_url }}"
    }
    {% endif %}
    ]
    }
  </script>

{% elsif template contains 'article' %}
  <script type="application/ld+json">
    {
    "@context": "http://schema.org/",
    "@type": "Article",
    "name": "{{ article.title  | replace: '"', '' }}",
    "description": "{{ article.content | split: '[lang2]' | first | replace: '&gt;', '>' | strip_html | replace: '"', '' | default: article.title  | replace: '"', '' }}",
    "author": "{{ article.author   | replace: '"', ''}}",
    "image": "{{ article | image_url: '1024x1024' }}",
    "headline": "{{ blog.title   | replace: '"', '' }}",
    "datePublished": "{{ article.created_at | date: format: 'abbreviated_date' }}",
    "dateModified": "{{ article.published_at | date: '%Y-%m-%d' }}"
    }
  </script>

  <script type="application/ld+json">
    {
    "@context": "http://schema.org/",
    "@type": "BreadcrumbList",
    "itemListElement": [{
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{url}}"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "{{ article.title | replace: '"', ''  }}",
      "item": "{{ canonical_url }}"
    }]
    }
  </script>
{% elsif template contains 'collection' and collection.handle %}
  <script type="application/ld+json">
    {
    "@context": "http://schema.org/",
    "@type": "CollectionPage",
    "name": "{{ collection.title | replace: '"', '' }}",
    "url": "{{ canonical_url }}",
    "description": "{{ collection.description | split: '[lang2]' | first | strip_html  | replace: '"', '' | default: collection.title | replace: '"', ''  }}"
    }
  </script>

  <script type="application/ld+json">
    {
    "@context": "http://schema.org/",
    "@type": "BreadcrumbList",
    "itemListElement": [{
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{url}}"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "{{ collection.title  | replace: '"', '' }}",
      "item": "{{ canonical_url }}"
    }]
    }
  </script>
{% endif %}
